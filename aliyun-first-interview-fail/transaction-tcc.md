## 面试题

描述分布式事务之TCC服务设计？

## 解析

TCC是一种应用层面的两阶段提交。
TCC的Try操作作为一阶段，负责资源的检查和预留；Confirm 操作作为二阶段提交操作，执行真正的业务；Cancel 是二阶段回滚操作，执行预留资源的取消，使资源回到初始状态。

#### try阶段：

下单和预留资源在同一事务中执行，当预留资源执行成功后，订单才会落库。

#### confirm阶段:

检查未完成的事务日志，执行调用confirm方法，正式使用掉资源。

### cancel阶段：

预留资源没有全部执行成功时，订单try阶段不会落库，在cancel阶段调用cancel方法使资源回到初始状态。